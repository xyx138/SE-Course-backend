# ğŸ¤– Agent = LLM + MCP + RAG

## ğŸ“ é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªç»“åˆå¤§è¯­è¨€æ¨¡å‹(LLM)ã€æ¨¡å‹ä¸Šä¸‹æ–‡åè®®(MCP)å’Œæ£€ç´¢å¢å¼ºç”Ÿæˆ(RAG)æŠ€æœ¯çš„æ™ºèƒ½Agentç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿå¯ä»¥é€šè¿‡æ£€ç´¢çŸ¥è¯†åº“çš„ç›¸å…³ä¿¡æ¯ï¼Œå€ŸåŠ©å¤§è¯­è¨€æ¨¡å‹çš„ç†è§£å’Œæ¨ç†èƒ½åŠ›ï¼Œå¹¶é€šè¿‡å·¥å…·è°ƒç”¨æ‰§è¡Œå®é™…æ“ä½œï¼Œæä¾›æ™ºèƒ½åŒ–çš„é—®ç­”å’Œä»»åŠ¡æ‰§è¡ŒåŠŸèƒ½ã€‚

## ğŸ§© æ ¸å¿ƒç»„ä»¶

### 1. ğŸ§  å¤§è¯­è¨€æ¨¡å‹ (LLM)

- åŸºäºOpenAIå…¼å®¹æ¥å£çš„LLMå®¢æˆ·ç«¯
- æ”¯æŒé€šä¹‰åƒé—®ç­‰å¤§æ¨¡å‹
- è´Ÿè´£è‡ªç„¶è¯­è¨€ç†è§£ã€æ¨ç†å’Œå›ç­”ç”Ÿæˆ

### 2. ğŸ”§ æ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP)

- åŸºäºMCPåè®®çš„å·¥å…·è°ƒç”¨æ¡†æ¶
- æ”¯æŒåŠ¨æ€åŠ è½½å’Œä½¿ç”¨å¤šç§å·¥å…·
- æä¾›æ–‡ä»¶æ“ä½œã€åœ°å›¾æŸ¥è¯¢ç­‰å·¥å…·èƒ½åŠ›

### 3. ğŸ“š æ£€ç´¢å¢å¼ºç”Ÿæˆ (RAG)

- åŸºäºå‘é‡æ•°æ®åº“çš„çŸ¥è¯†æ£€ç´¢ç³»ç»Ÿ
- æ”¯æŒåˆ›å»ºå’Œç®¡ç†å¤šä¸ªçŸ¥è¯†åº“
- åˆ©ç”¨è¯­ä¹‰æ£€ç´¢æŠ€æœ¯æ‰¾åˆ°æœ€ç›¸å…³çš„ä¿¡æ¯

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç”¨æˆ·ç•Œé¢      â”‚
â”‚  (Gradio WebUI)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Agent æ ¸å¿ƒ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   â”‚
â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    LLM    â”‚  â”‚    MCP     â”‚  â”‚    RAG     â”‚
â”‚  å®¢æˆ·ç«¯   â”‚  â”‚  å·¥å…·å®¢æˆ·ç«¯ â”‚  â”‚ æ£€ç´¢ç³»ç»Ÿ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- **ğŸ¤” æ™ºèƒ½é—®ç­”**ï¼šåŸºäºçŸ¥è¯†åº“å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜
- **ğŸ› ï¸ å·¥å…·è°ƒç”¨**ï¼šé€šè¿‡MCPåè®®ä½¿ç”¨å¤–éƒ¨å·¥å…·æ‰§è¡Œä»»åŠ¡
    >ç›®å‰åªæ¥å…¥äº†fetchã€filesystemã€é«˜å¾·åœ°å›¾
- **ğŸ“‹ çŸ¥è¯†ç®¡ç†**ï¼šæ”¯æŒåˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤çŸ¥è¯†åº“
- **ğŸ”„ çµæ´»æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°çš„å·¥å…·å’ŒåŠŸèƒ½

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ğŸ” ç¯å¢ƒè¦æ±‚

- Python 3.10+
- å¿…è¦çš„PythonåŒ…ï¼ˆåœ¨requirements.txtä¸­åˆ—å‡ºï¼‰

### â–¶ï¸ å¯åŠ¨æœåŠ¡

1. å…‹éš†é¡¹ç›®å¹¶è¿›å…¥é¡¹ç›®

   ```bash
   git clone git@github.com:xyx138/agent-llm-mcp-rag.git
   cd agent-llm-mcp-rag
   ```

2. å®‰è£… uv

   ```bash
   curl -LsSf https://astral.sh/uv/install.sh | sh  # linux/mac
   powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"  # windows
   ```

   é‡å¯ç»ˆç«¯ï¼Œç¡®ä¿ uv å‘½ä»¤ç”Ÿæ•ˆ

3. è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼Œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

   ```bash
   uv python pin 3.11 # æŒ‡å®špythonç‰ˆæœ¬
   uv sync # åˆ›å»ºç¯å¢ƒå¹¶åŒæ­¥ä¾èµ–
   ```

4. å®‰è£… node ï¼ˆä»¥windowsä¸ºä¾‹ï¼Œå¦‚æœå®‰è£…è¿‡nodeè·³è¿‡è¿™æ­¥ï¼‰

   è®¿é—®[nodeå®˜ç½‘](https://nodejs.org/en)ï¼Œé€‰æ‹©ä¸‹è½½msiæ–‡ä»¶ï¼Œç‚¹å‡»msiæ–‡ä»¶åä¸€è·¯å³å¯

   ```bash
   # éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ
   node -v # v22.15.0
   npm -v # 10.9.2
   ```

5. ä¿®æ”¹é…ç½®æ–‡ä»¶

   å¤åˆ¶`.env.example`åˆ°åŒçº§ç›®å½•ä¸‹ï¼Œå¹¶æ›´åä¸º`.env`, å°†å…¶ä¸­çš„**apiå’Œé¡¹ç›®è·¯å¾„**æ”¹ä¸ºè‡ªå·±çš„ï¼Œåˆ›å»ºapiå¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡æ¡£

   ![image-20250506143814101](https://raw.githubusercontent.com/xyx138/cloudimg/master/img/image-20250506143814101.png)

   [é«˜å¾·åœ°å›¾apiæƒé™è·å–å’Œåˆ›å»º](https://amap.apifox.cn/doc-537183)

   [åƒé—®apiæƒé™è·å–å’Œåˆ›å»º](https://help.aliyun.com/zh/model-studio/get-api-key?spm=a2c4g.11186623.0.0.374f6401cARvVK)

6. å¯åŠ¨é¡¹ç›®

```bash
uv run src/main.py
```

7. è®¿é—®[ç”¨æˆ·ç•Œé¢](http://localhost:7860/)ï¼Œ æ•ˆæœå¦‚ä¸‹

![image-20250506143022619](https://raw.githubusercontent.com/xyx138/cloudimg/master/img/image-20250506143022619.png)

### ğŸ“– çŸ¥è¯†åº“ç®¡ç†

- åˆ›å»º/æ›´æ–°çŸ¥è¯†åº“ï¼šä¸Šä¼ æ–‡ä»¶å¹¶æŒ‡å®šçŸ¥è¯†åº“åç§°
- åˆ é™¤çŸ¥è¯†åº“ï¼šé€‰æ‹©è¦åˆ é™¤çš„çŸ¥è¯†åº“
- åˆ‡æ¢çŸ¥è¯†åº“ï¼šé€‰æ‹©è¦ä½¿ç”¨çš„çŸ¥è¯†åº“

### ğŸ’¬ æ™ºèƒ½é—®ç­”

åœ¨èŠå¤©ç•Œé¢ä¸­è¾“å…¥é—®é¢˜ï¼Œç³»ç»Ÿä¼šï¼š

1. ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯
2. é€šè¿‡å¤§è¯­è¨€æ¨¡å‹ç†è§£å’Œå¤„ç†é—®é¢˜
3. å¿…è¦æ—¶è°ƒç”¨å¤–éƒ¨å·¥å…·è·å–é¢å¤–ä¿¡æ¯
4. ç”Ÿæˆå›ç­”å¹¶è¿”å›ç»™ç”¨æˆ·

## ğŸ“ é¡¹ç›®ç»“æ„

```
agent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py          # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ agent.py         # Agentæ ¸å¿ƒå®ç°
â”‚   â”œâ”€â”€ llmClient.py     # LLMå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ mcpClient.py     # MCPå·¥å…·å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ retrieve.py      # æ£€ç´¢æ¨¡å—
â”‚   â”œâ”€â”€ vectorStore.py   # å‘é‡å­˜å‚¨ç®¡ç†
â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”œâ”€â”€ knowledge_base/      # çŸ¥è¯†åº“æ–‡ä»¶å­˜å‚¨
â”œâ”€â”€ VectorStore/         # å‘é‡å­˜å‚¨æ•°æ®åº“
â””â”€â”€ mcp.json             # MCPå·¥å…·é…ç½®
```

## ğŸ”¬ æŠ€æœ¯è¯´æ˜

### ğŸ¤– LLMé›†æˆ

ç³»ç»Ÿä½¿ç”¨OpenAIå…¼å®¹æ¥å£è¿æ¥åˆ°LLMæœåŠ¡ï¼Œæ”¯æŒtool callingç­‰é«˜çº§åŠŸèƒ½ã€‚

### ğŸ”¨ MCPå·¥å…·

- åŸºäºæ ‡å‡†MCPåè®®å®ç°å·¥å…·è°ƒç”¨
- æ”¯æŒå¤šç§å·¥å…·æœåŠ¡å¹¶è¡Œè¿è¡Œ
- æä¾›æ ‡å‡†åŒ–çš„å·¥å…·æè¿°å’Œè°ƒç”¨æ¥å£

### ğŸ” RAGç³»ç»Ÿ

- ä½¿ç”¨DashScope Embeddingç”Ÿæˆæ–‡æ¡£å‘é‡
- æ”¯æŒç›¸ä¼¼åº¦é˜ˆå€¼è¿‡æ»¤å’Œé‡æ’åº
- å¯å¤„ç†å¤šç§æ–‡æ¡£æ ¼å¼

## ğŸ§© æ‰©å±•å¼€å‘

### ğŸ”Œ æ·»åŠ æ–°å·¥å…·

1. åœ¨mcp.jsonä¸­æ·»åŠ æ–°çš„å·¥å…·æœåŠ¡é…ç½®
2. å®ç°ç¬¦åˆMCPåè®®çš„å·¥å…·æœåŠ¡
3. é‡å¯ç³»ç»Ÿä½¿æ–°å·¥å…·ç”Ÿæ•ˆ

### âš™ï¸ ä¼˜åŒ–æ£€ç´¢ç³»ç»Ÿ

å¯ä»¥é€šè¿‡è°ƒæ•´ä»¥ä¸‹å‚æ•°ä¼˜åŒ–æ£€ç´¢æ•ˆæœï¼š

- similarity_thresholdï¼šç›¸ä¼¼åº¦é˜ˆå€¼
- chunk_cntï¼šè¿”å›çš„æ–‡æ¡£å—æ•°é‡

## ğŸ™ æ„Ÿè°¢

**[llm-mcp-rag](https://github.com/KelvinQiu802/llm-mcp-rag)**

**[Building effective agents](https://www.anthropic.com/engineering/building-effective-agents)**

**[æ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP)](https://docs.anthropic.com/zh-CN/docs/agents-and-tools/mcp)**

**[åŸºäºæœ¬åœ°çŸ¥è¯†åº“æ„å»ºRAGåº”ç”¨](https://help.aliyun.com/zh/model-studio/build-rag-application-based-on-local-retrieval)**
